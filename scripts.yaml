bedroom_chromecast_on:
  alias: Bedroom Tv On
  sequence:
    - service: switch.turn_on
      data:
        entity_id: switch.bedroom_tv_power, switch.bedroom_speakers
bedroom_chromecast_off:
  alias: Bedroom Tv Off
  sequence:
    - service: media_player.turn_off
      data:
        entity_id: media_player.chromecast0856
    - service: switch.turn_off
      data:
        entity_id: switch.bedroom_tv_power, switch.bedroom_speakers
all_off:
  alias: All off
  sequence:
    - service: switch.turn_off
      data:
        entity_id: group.switch_lights
    - service: light.turn_off
      data:
        entity_id: group.all_lights
theather:
  alias: Theater Mode
  sequence:
    - service: script.all_off
bedtime:
  alias: Bedtime
  sequence:
    - delay:
        minutes: 30
    - service: script.bedroom_chromecast_off
    - service: script.all_off
automatic_light_toggle:
  alias: Automatic Light Toggle
  sequence:
    - service_template: >
        {% if is_state(entity_id, 'on') %}
          light.turn_off
        {% else %}
          script.automatic_light_on
        {% endif %}
      data_template:
        entity_id: "{{ entity_id }}"
automatic_light_on:
  alias: Automatic Light With Brightness
  sequence:
    - service: light.turn_on
      data_template:
        entity_id: "{{ entity_id }}"
        brightness: >
         {% if is_state('sun.sun', 'below_horizon') %}
           {% if now().hour > 6 and now().hour < 23 %}
            77
           {% else %}
            2
           {% endif %}
         {% else %}
           255
         {% endif %}
incrementing_light:
  alias: Incrementing light brightness
  sequence:
    - service: light.turn_on
      data_template:
        entity_id: "{{ entity_id }}"
        brightness: >
         {% if is_state(entity_id, 'off') %}
           2
         {% elif state_attr(state_attr(entity_id, 'entity_id')[0], 'brightness') == 2 %}
           77
         {% elif state_attr(state_attr(entity_id, 'entity_id')[0], 'brightness') == 77 %}
           255
         {% else %}
           2
         {% endif %}
three_tier_light:
  alias: Three Tier Xiaomi Light
  sequence:
    - service: light.turn_on
      data_template:
        entity_id: "{{ entity_id }}"
        brightness: >
         {% if click == 'double' %}
           77 
         {% elif click == 'triple' %}
           255
         {% elif click == 'quadruple' %}
           2
         {% endif %}
automatic_light_switch:
  alias: Standard Xiaomi Two-button Switch Light Controls
  sequence:
    - service_template: >
        {% if click == 'right'  %}
          script.incrementing_light
        {% elif click == 'left'  %}
          script.automatic_light_toggle
        {% endif %}
      data_template:
        entity_id: "{{ entity_id }}"
automatic_light_button:
  alias: Standard Xiaomi Button Light Controls
  sequence:
    - service_template: >
        {% if click == 'single'  %}
          script.automatic_light_toggle
        {% else %}
          script.three_tier_light
        {% endif %}
      data_template:
        entity_id: "{{ entity_id }}"
        click: "{{ click }}"
bedroom_button:
  alias: Generic Bedroom Button
  sequence:
    - service_template: >
       {% if click == 'single' %}
         switch.toggle
       {% elif click == 'double' %}
         script.automatic_light_toggle
       {% elif click == 'triple' %}
         script.tv_toggle
       {% endif %}
      data_template:
        entity_id: >
         {% if click == 'single' %}
           "{{ lamp_entity_id }}"
         {% elif click == 'double' %}
           group.bedroom_lights
         {% endif %}
tv_toggle:
  alias: Bedroom TV Toggle
  sequence:
    - service_template: >
        {% if is_state('switch.bedroom_tv_power', 'on') %}
          script.bedroom_chromecast_off
        {% else %}
          script.bedroom_chromecast_on
        {% endif %}
